# Beat Tracker Comparison Report

**Song**: Tool - Opiate (Intro)

**Audio File**: `Opiate Intro.wav` (~40s)

**Problem**: librosa's default `beat_track()` incorrectly detected 161.5 BPM when the actual tempo is ~101-109 BPM (based on user tap annotations).

## Reference Data

- **Total user taps**: 72
- **Steady groove taps** (8.0s - 24.0s): 26
- **Estimated tempo from taps**: 102.6 BPM
- **Match tolerance**: ±100ms

### Song Structure (from change markers)

Based on user annotations, the song has distinct sections:

- **Section A (0-8s)**: Intro, variable tempo, rapid hits at ~160 BPM
- **Section B (8-17s)**: Steady groove at ~105 BPM ← **PRIMARY EVALUATION SECTION**
- **Section C (17-24s)**: Groove continues ← **PRIMARY EVALUATION SECTION**
- **Section D (24-29s)**: Fills with rapid bursts
- **Section E+ (29-40s)**: More variation and fills

**Evaluation focuses on sections B and C** (8-24s) where the user's taps are most metronomic.

## Approaches Tested

1. **librosa default**: Baseline: `librosa.beat.beat_track()` with default parameters
2. **librosa constrained**: Constrained tempo: `start_bpm` parameter set to 100, 105, or 110
3. **librosa bass-only onset**: Bass-focused: onset detection using only 20-250Hz frequency range
4. **madmom RNN**: Neural network: RNN beat processor trained on annotated data (if available)
5. **spectral flux**: Custom: spectral flux peaks + autocorrelation, constrained to 80-130 BPM

## Results

### Comparison Table

| Rank | Approach | Tempo (BPM) | Precision | Recall | F1 | Beats Detected | Notes |
|------|----------|-------------|-----------|--------|----|-----------------|-------|
| 1 | librosa_bass_onset | 110.0 | 0.467 | 0.538 | 0.500 | 30 | Uses only bass frequencies (20-250Hz) for onset detection |
| 2 | librosa_default | 161.5 | 0.386 | 0.654 | 0.486 | 44 | Known to double tempo on rock music (locks onto hi-hat instead of kick) |
| 3 | librosa_constrained_100 | 161.5 | 0.386 | 0.654 | 0.486 | 44 | Constrained to start at 100 BPM |
| 4 | librosa_constrained_105 | 161.5 | 0.386 | 0.654 | 0.486 | 44 | Constrained to start at 105 BPM |
| 5 | librosa_constrained_110 | 161.5 | 0.386 | 0.654 | 0.486 | 44 | Constrained to start at 110 BPM |
| 6 | spectral_flux | 82.0 | 0.310 | 0.346 | 0.327 | 29 | Custom: spectral flux peaks + autocorrelation, constrained to 80-130 BPM |
| - | madmom_rnn | N/A | N/A | N/A | N/A | N/A | Could not be installed (requires Cython build environment) |

### Metrics Explained

- **Precision**: % of detected beats that match a user tap (within ±100ms)
- **Recall**: % of user taps that have a matching detected beat (within ±100ms)
- **F1**: Harmonic mean of precision and recall (balanced accuracy)

## Analysis

### Best Performing Approach: **librosa_bass_onset**

- **Detected tempo**: 110.0 BPM (reference: 102.6 BPM)
- **F1 score**: 0.500
- **Precision**: 0.467
- **Recall**: 0.538
- **Notes**: Uses only bass frequencies (20-250Hz) for onset detection

### Why librosa Default Failed

The default approach detected **161.5 BPM** — approximately double the true tempo. This is a common failure mode for rock music where:

- The algorithm locks onto hi-hat or eighth-note subdivisions instead of the kick drum
- Without tempo constraints, it finds local maxima at the wrong periodicity
- Rock's dense, distorted instrumentation creates many onset candidates

## Recommendations

Based on this comparison:

1. **None of the tested approaches achieved strong performance** (best F1 < 0.7)
2. Consider user tap data as the ground truth for LED programming
3. **User tap annotations are richer than beat tracking**: They capture subdivision changes, fills, and structural transitions
4. **For LED effects**, the imperfections in user taps ARE the data — they reflect musical intensity and variation

## Data Output

All detected beat times are saved to `beat_tracker_comparison.yaml` for further analysis.

---

*Generated by `beat_tracker_comparison.py`*
